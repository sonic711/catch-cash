Configuration:
  name: Default
  status: DEBUG
  monitorInterval: 30
  shutdownHook: disable
  Properties:
    Property:
      - name: BASE_PATH
        value: ${sys:BASE_PATH:-/app/sean/log}
      - name: APPLICATION_NAME
        value: ${sys:APPLICATION_NAME:-web}
      - name: LOG_PATH
        value: ${property:BASE_PATH}/${property:APPLICATION_NAME}
      - name: LOG_EXCEPTION_CONVERSION_WORD
        value: '%xwEx{none}'
  Appenders:
    Console:
      - name: STDOUT
        target: SYSTEM_OUT
        PatternLayout:
          disableAnsi: ${sys:LOG4J2_DISABLE_ANSI:-false}
          Pattern: '%d{HH:mm:ss.SSS} [%highlight{%thread}{INFO=green bold, DEBUG=Bright blue, TRACE=Normal, FATAL=red blink, ERROR=red, WARN=yellow}] %highlight{%-5level %logger{36}}{FATAL=red blink, ERROR=red, WARN=yellow, INFO=green bold, DEBUG=Bright blue, TRACE=Normal} %X - %msg%n${LOG_EXCEPTION_CONVERSION_WORD}'
    RollingFile:
      - name: APPLICATION
        ignoreExceptions: false
        fileName: ${LOG_PATH}/${APPLICATION_NAME}_application.log
        filePattern: ${LOG_PATH}/%d{yyyyMMdd}/${APPLICATION_NAME}_application_%d{yyyyMMddHH}.log.gz
        PatternLayout:
          charset: "UTF-8"
          pattern: '%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %X - %msg%n${LOG_EXCEPTION_CONVERSION_WORD}'
        Policies:
          TimeBasedTriggeringPolicy:
            modulate: true
            interval: 1
        DefaultRolloverStrategy:
          max: 720
          Delete:
            - basePath: "${LOG_PATH}"
              maxDepth: 2
              IfFileName:
                glob: "*/${APPLICATION_NAME}_application_*.log.gz"
              IfLastModified:
                age: "30d"
      - name: SELF-MONITORING
        ignoreExceptions: false
        fileName: ${LOG_PATH}/self_monitoring.log
        filePattern: ${LOG_PATH}/%d{yyyyMMdd}/${APPLICATION_NAME}_self_monitoring_%d{yyyy-MM-dd-HH}.log.gz
        PatternLayout:
          charset: "UTF-8"
          pattern: '%d{HH:mm:ss} - %msg%n'
        Policies:
          TimeBasedTriggeringPolicy:
            modulate: true # 確保滾動發生在整點時
            interval: 1 # 每小時觸發
        DefaultRolloverStrategy:
          max: 720 # 30日清除
          Delete: #刪除策略依照設定天數刪除
            basePath: "${LOG_PATH}"
            maxDepth: 2
            IfFileName:
              glob: "*/${APPLICATION_NAME}_self_monitoring_*.log.gz"
            IfLastModified:
              age: "30d"
  Loggers:
    Root:
      level: INFO
      includeLocation: true
      AppenderRef:
        - ref: STDOUT
        - ref: APPLICATION
    AsyncLogger:
      - name: SELF-MONITORING
        level: DEBUG
        additivity: false
        AppenderRef:
          - ref: SELF-MONITORING
